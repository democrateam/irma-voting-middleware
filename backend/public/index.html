<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>example</title>
    <meta name="example" content="example" />
    <link rel="stylesheet" href="./irma.css" />
    <script src="./irma.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="irma-web-form" id="irma-web-form"></div>
  </body>
  <script type="text/javascript" defer>
    let options = {
      debugging: true,
      element: "#irma-web-form",
      session: {
        url: "http://localhost:3000/user/disclose",
        start: {
          url: (o) => `${o.url}/start`,
          method: "GET",
        },
        mapping: {
          sessionPtr: (r) => r,
        },
        result: {
          url: (o) => `${o.url}/finish`,
          parseResponse: (r) => r.status,
        },
      },
    };

    const irmaWeb = irma.newWeb(options);
    irmaWeb
      .start()
      .then((result) => {
        if (result !== 200) throw new Error("disclosure failed");
        console.log("disclosure completed");
        options.session.url = options.session.url.replace("disclose", "issue");
        const irmaWeb = irma.newWeb(options);
        irmaWeb.start().then((result) => {
          if (result !== 200) throw new Error("issuance failed");
          console.log("issuance completed");
        });
      })
      .catch((error) => console.error("error: ", error));
  </script>
</html>
