<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Stemmen met IRMA</title>
		<link href="style.css" rel="stylesheet">
    <link rel="stylesheet" href="./irma.css" />
    <script src="./irma.js" type="text/javascript"></script>
  </head>
  <body>
<header class="navbar sticky-lg-top shadow-sm navbar-expand-lg navbar-dark mb-3 shadow-sm">
<nav class="container">
	<a class="navbar-brand" href="#"><img src="irma-logo.svg" height="25"> Stemmen met IRMA</a>
</nav>
</header>

<div class="container mt-3">
	<div class="row">
		<div class="col-8">
			<div class="card overflow-hidden mb-3 pb-0 h-100">
				<div class="card-header">Stemmen is mogelijk tot 29 februari 2021.</div>
				<div class="row h-100">
					<img src="https://www.ru.nl/publish/pages/802240/364px/uvb-erasmusgebouw.jpg" class="col-md-4 h-100 pr-0" style="object-fit: cover" />
					<div class="col-md-8 ps-0">
						<div class="card-body position-relative h-100">
							<h2>Wat wordt de naam van het nieuwe universiteitsgebouw?</h2>
							<p class="card-text">U kunt nu stemmen. Selecteer de gewenste optie, en kies bevestig.</p>

							<div class="form-check">
								<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
								<label class="form-check-label" for="flexRadioDefault1">
									Optie 1
								</label>
							</div>
							<div class="form-check">
								<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
								<label class="form-check-label" for="flexRadioDefault2">
									Optie 2
								</label>
							</div>
							<div class="form-check">
								<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault3">
								<label class="form-check-label" for="flexRadioDefault3">
									Optie 3
								</label>
							</div>
							<button id="confirm" class="btn btn-primary float-end mt-3">bevestig</button>
							<p id="after-confirm" class="card-text mt-3 text-end d-none">Bevestig uw stem door de QR code met IRMA te scannen.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-4">
			<div id="irma-web-form" class="w-100 irma-web-form" style="max-width: 100%">
				<div class="irma-web-header ">
					<p>Ga verder met <i class="irma-web-logo">IRMA</i></p>
					<div class="irma-web-helper">
						<p>Kom je er niet uit? Kijk dan eerst eens op <a href="https://irma.app/">de website van IRMA</a>.</p>
					</div>

				</div>
				<div class="irma-web-content">
					<div class="irma-web-centered">
						Selecteer eerst een stemoptie in het linker scherm.
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container mt-5">
		<div class="position-relative my-4 col-lg-6 mx-auto">
			<div class="progress" style="height: 0.1rem;">
				<div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<button type="button" class="position-absolute top-0 start-0 translate-middle-y btn btn-sm btn-primary rounded-pill">Identificeren</button>
			<button type="button" class="position-absolute top-0 start-50 translate-middle btn btn-sm btn-primary rounded-pill">Stemkaart ophalen</button>
			<button type="button" class="position-absolute top-0 end-0 translate-middle-y btn btn-sm btn-primary rounded-pill">Stem uitbrengen</button>
		</div>
</div>


<footer class="footer mt-5 py-3 border-top">
  <div class="container">
		<div class="row">
			<div class="col-sm-6">
				<h6>iLab: experiments @ iHub</h6>
			</div>
			<div class="col-sm-6">
				<h6>iHub: interdisciplinary Hub for Security, Privacy, and Data Governance</h6>
			</div>
		</div>
		<div class="row mt-3">
			<div class="col-sm-6">
				<h6>Location</h6>
				<address>
					19th floor of the Erasmus-building<br>
					Radboud University
				</address>
			</div>
			<div class="col-sm-6">
				<h6>Postal</h6>
				<address>
					iHub, Radboud University<br>
					Erasmusplein 1<br>
					6525 HT Nijmegen<br>
					The Netherlands
				</address>
			</div>
		</div>
  </div>
</footer>
		<script src="main.js"></script>
  </body>
  <script type="text/javascript" defer>

document.getElementById('confirm').addEventListener("click", function(event) { 
	event.target.disabled = true;
	event.target.classList.add("d-none");
	let inputs = document.getElementsByTagName('input');
	console.log(inputs);
	let text = "";
	for (let i = 0; i < inputs.length; ++i) {
		let input = inputs[i];
		input.disabled = true;
		if (input.checked) {
			text = input.labels[0].innerHTML;
		}
	}
	let after = document.getElementById('after-confirm');
	after.classList.remove('d-none')
	after.classList.add('d-block')
	console.log(event);
	text = text.trim();
	console.log(text);

	let options = {
		debugging: true,
		element: "#irma-web-form",
		session: {
			url: "/vote",
				start: {
					url: (o) => `${o.url}/start`,
					method: "POST",
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({text: text}),
				},
				mapping: {
					sessionPtr: (r) => r,
				},
				result: {
					url: (o) => `${o.url}/finish`,
						parseResponse: (r) => r.status,
				},
		},
	};

	const irmaWeb = irma.newWeb(options);
	irmaWeb
		.start()
		.then((result) => {
			// wait two seconds to display check mark
			return new Promise((resolve) =>
				setTimeout(() => resolve(result), 2000)
			);
		})
		.then((result) => {
			if (result !== 200) throw new Error("issuance failed");
			console.log("issuance completed");
			//window.location.href = "next.html";
		})
		.catch((error) => console.error("error: ", error));
});
  </script>
</html>
